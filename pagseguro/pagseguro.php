<?phpdate_default_timezone_set('America/Sao_Paulo');//integração com o pag seguro //o codigo abaixo creio eu é o minimo q é preciso para buscar o xml e fazer a compra//-------------------------------------------------------------------------------------//$data['email'] = 'serralheriasjccarlos@hotmail.com';//$data['token'] = '67288B508FAE430790D02A022A476954';//$data["currency"] = 'BRL';//$data["itemId1"] = "99";//$data["itemDescription1"] = "Produto";//$data["itemAmount1"] = "5.00";//$data["itemQuantity1"] = "3";//-------------------------------------------------------------//$data = 'email=seuemail@dominio.com.br&amp;token=95112EE828D94278BD394E91C4388F20&amp;currency=BRL&amp;itemId1=0001&amp;itemDescription1=Notebook Prata&amp;itemAmount1=24300.00&amp;itemQuantity1=1&amp;itemWeight1=1000&amp;itemId2=0002&amp;itemDescription2=Notebook Rosa&amp;itemAmount2=25600.00&amp;itemQuantity2=2&amp;itemWeight2=750&amp;reference=REF1234&amp;senderName=Jose Comprador&amp;senderAreaCode=11&amp;senderPhone=56273440&amp;senderEmail=comprador@uol.com.br&amp;shippingType=1&amp;shippingAddressStreet=Av. Brig. Faria Lima&amp;shippingAddressNumber=1384&amp;shippingAddressComplement=5o andar&amp;shippingAddressDistrict=Jardim Paulistano&amp;shippingAddressPostalCode=01452002&amp;shippingAddressCity=Sao Paulo&amp;shippingAddressState=SP&amp;shippingAddressCountry=BRA';/*  Caso utilizar o formato acima remova todo código abaixo até instrução $data = http_build_query($data); */include '../business/php/connect.php';$id_cli = $_POST['id'];$valorFrete = $_POST['valorFrete'];////credenciais ////----------//////---------$data['email'] = 'serralheriasjccarlos@hotmail.com';$data['token'] = '67288B508FAE430790D02A022A476954';$data["currency"] = 'BRL';//// resgata os dados do cliente no BD////busca os registros de compra do usuario $sql = "SELECT `id`, `id_usuario`,`quant`, `id_produto`, `status` FROM `registro_de_compras` WHERE  id_usuario =" . $id_cli . "  AND (status= 'Apenas Clicou Em Comprar' OR status= 'Foi Ate O PagSeguro') ";$query = $conexao->query($sql);//cria o array com os ids dos produtos e a quantidade comprada$ids_produtos = array();$j = 1;while ($dados = $query->fetch_assoc()) {//    busca os dados e transfere para o array    $id_produto = $dados['id_produto'];    $quantidadeProd = $dados['quant'];    $ids_produtos[$j]["id_produto"] = $id_produto;    $ids_produtos[$j]["quant"] = $quantidadeProd;    $j++;}$i = 1;foreach ($ids_produtos as $idp) {//    percorre os produtos e quantidades    $idProdF = $idp["id_produto"];    $quantidadeProdF = $idp["quant"];//    busca dados dos produtos    $sql = "SELECT * FROM `produtos` WHERE id = $idProdF";    $query = $conexao->query($sql);    while ($dados = $query->fetch_assoc()) {        $nomeProd = $dados['nome'];        $valorProd = $dados['valor'];    }    mysqli_free_result($query);//    //------------------////---------------------------    $data["itemId$i"] = "$idProdF";    $data["itemDescription$i"] = "$nomeProd";    $data["itemAmount$i"] = "$valorProd";    $data["itemQuantity$i"] = "$quantidadeProdF";//    $data["itemWeight$i"] = '1000';//    //------------------////---------------------------    $i++;}    $data["itemId$i"] = "000";    $data["itemDescription$i"] = "Frete";    $data["itemAmount$i"] = "$valorFrete";    $data["itemQuantity$i"] = "1";$sql = "SELECT * FROM `usuario` WHERE  id =" . $id_cli;$query = $conexao->query($sql);while ($dados = $query->fetch_assoc()) {    $nome = $dados['nome'];    $ddd = $dados['ddd'];    $telefone = $dados['tel'];    $cep = $dados['cep'];    $rua = $dados['rua'];    $numero = $dados['numero'];    $bairro = $dados['bairro'];    $complemento = $dados['complemento'];    $cidade = $dados['cidade'];    $uf = $dados['uf'];    $email = $dados['email'];}mysqli_free_result($query);////------------------////---------------------------$referencia = "REF" . date('dmYhis') . $id_cli;$dataCompra = date('d/m/Y  h:i');//salva a referencia,data e muda status no registro de compras $sql = "UPDATE `registro_de_compras` SET  `ref`= '$referencia',`data_compra`= '$dataCompra',`status`= 'Foi Ate O PagSeguro'  WHERE id_usuario = '" . $id_cli . "' AND (status= 'Apenas Clicou Em Comprar' OR status= 'Foi Ate O PagSeguro') ";$query = $conexao->query($sql);//mysqli_free_result($query);$sql = "SELECT `ref` FROM `registro_de_compras`  WHERE id_usuario = '" . $id_cli . "' AND status= 'Foi Ate O PagSeguro'";$query = $conexao->query($sql);while ($dados = $query->fetch_assoc()) {    $referenciaC = $dados['ref'];}//mysqli_free_result($query);$data['reference'] = "$referenciaC";$data['senderName'] = "$nome";$data['senderAreaCode'] = "$ddd";$data['senderPhone'] = "$telefone";$data['senderEmail'] = "$email";$data['shippingType'] = '1';$data['shippingAddressStreet'] = "$rua";$data['shippingAddressNumber'] = "$numero";$data['shippingAddressComplement'] = "$complemento";$data['shippingAddressDistrict'] = "$bairro";$data['shippingAddressPostalCode'] = "$cep";$data['shippingAddressCity'] = "$cidade";$data['shippingAddressState'] = "$uf";$data['shippingAddressCountry'] = 'BRA';//echo json_encode($data);$url = 'https://ws.sandbox.pagseguro.uol.com.br/v2/checkout';$data = http_build_query($data);//echo $data.'<br>';$curl = curl_init($url);curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false);curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);curl_setopt($curl, CURLOPT_POST, true);curl_setopt($curl, CURLOPT_HTTP_VERSION, CURL_HTTP_VERSION_1_1);curl_setopt($curl, CURLOPT_POSTFIELDS, $data);$xml = curl_exec($curl);//echo $xml;if ($xml == 'Unauthorized') {//Insira seu código de prevenção a erros//    header('Location: erro.php?tipo=autenticacao');    exit; //Mantenha essa linha}curl_close($curl);//echo $xml;$xml = simplexml_load_string($xml);if (count($xml->error) > 0) {//Insira seu código de tratamento de erro, talvez seja útil enviar os códigos de erros.//header('Location: erro.php?tipo=dadosInvalidos');    exit;}echo $xml->code;//header('Location: https://sandbox.pagseguro.uol.com.br/v2/checkout/payment.html?code=' . $xml->code);//------------------////---------------------------