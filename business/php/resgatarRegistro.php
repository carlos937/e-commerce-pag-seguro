<?phprequire_once 'connect.php';header('Content-Type:' . "application/json");$ArrayGeral = array();$referencias = array();$sql = "SELECT ref FROM registro_de_compras";$query = $conexao->query($sql);$repetida = "nao";while ($dados = $query->fetch_assoc()) {    foreach ($referencias as $r) {        if ($r == $dados['ref']) {            $repetida = "sim";        }    }    if ($repetida == "nao") {        $referencias[] = $dados['ref'];    } else {        $repetida = "nao";    }}$j = 0;foreach ($referencias as $ref) {        $sql = "SELECT *,produtos.nome AS nomeprod ,registro_de_compras.quant AS rcq ,registro_de_compras.id AS rcid  FROM registro_de_compras INNER JOIN produtos ON registro_de_compras.id_produto = produtos.id "            . " WHERE  registro_de_compras.ref = '$ref'";    $query = $conexao->query($sql);    $i = 0;    while ($dados = $query->fetch_assoc()) {        $id_usuario = $dados['id_usuario'];        $data_compra = $dados['data_compra'];                $vendedor = $dados['vendedor'];                $status = $dados['status'];        $ArrayGeral[$j]['produtos'][$i]['id_produto'] = $dados['id_produto'];                $ArrayGeral[$j]['produtos'][$i]['id_registro'] = $dados['rcid'];        $ArrayGeral[$j]['produtos'][$i]['quantidade_produto'] = $dados['rcq'];        $ArrayGeral[$j]['produtos'][$i]['nome_produto'] = $dados['nomeprod'];                $ArrayGeral[$j]['produtos'][$i]['comprimento'] = $dados['comprimento'];        $ArrayGeral[$j]['produtos'][$i]['cor_produto'] = $dados['cor'];                $ArrayGeral[$j]['produtos'][$i]['desconto'] = $dados['desconto'];                $ArrayGeral[$j]['produtos'][$i]['valor'] = $dados['valor'];        $ArrayGeral[$j]['produtos'][$i]['valorTotalC'] = $dados['valorTotalC'];        $i++;    }            if($vendedor != 0){    $sql2 = "SELECT * FROM usuario WHERE id = $vendedor";    $query2 = $conexao->query($sql2);    while ($dadosUsuario = $query2->fetch_assoc()) {        $loginUsuario = $dadosUsuario['login'];            }    }else{        $loginUsuario = "Web";    }    $ArrayGeral[$j]['vendedor'] = $loginUsuario;        $ArrayGeral[$j]['id_cliente'] = $id_usuario;    $ArrayGeral[$j]['ref'] = $ref;        $ArrayGeral[$j]['status'] = $status;    $ArrayGeral[$j]['data_compra'] = $data_compra;    $j++;}echo json_encode($ArrayGeral, JSON_PRETTY_PRINT);